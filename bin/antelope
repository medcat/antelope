#!/usr/bin/env ruby

$: << File.expand_path("../../lib", __FILE__)
require "antelope"
require "erb"

program = ARGV[0]

def get_classes
  Object.constants.map { |c| Object.const_get(c) }.select { |c| c.is_a? Class}
end

current_consts = get_classes

$: << Dir.pwd
require program

parser = (get_classes - current_consts).select { |x| x < Antelope::Parser }.first

recognizer, c = parser.generate

file_name = File.basename(program, ".rb")

File.open("#{file_name}.output", "w") do |f|
  f.write Antelope::Output.output(parser,
                                  :recognizer => recognizer,
                                  :constructor => c)
end
